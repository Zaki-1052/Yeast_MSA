# Yeast MSA: Comprehensive Gene Mapping and Generalized Gene-Level Analysis

## Project Overview

This project expands the gene-level analysis capabilities for yeast mutation data by generating a comprehensive gene mapping file from GenBank annotations and updating analysis scripts to use this mapping. The new mapping covers all chromosomes and genes, enabling robust variant-to-gene mapping and genome-wide gene-level analyses, including detection of selection in genes of interest (e.g., ergosterol pathway genes).

## Motivation and Context

Previous gene mapping files only covered a subset of chromosomes and genes, resulting in no variants being mapped to many genes of interest. By parsing all GenBank files, we now have a complete mapping, allowing for:
- Accurate mapping of variants to all genes across all chromosomes
- Genome-wide gene-level analyses
- Improved detection of selection (enrichment/depletion) in any gene or gene set

This work builds on the goals and strategies outlined in `scripts/gene_analysis/context.md`, with a focus on:
- Enabling gene-specific analyses for all genes, not just a subset
- Supporting robust purifying selection and enrichment analyses
- Ensuring consistent, reproducible, and extensible workflows

## The New Gene Mapping File

The new mapping file, `reference/gene_mapping_full.tsv`, is generated by parsing all GenBank files in `reference/w303_annotations/`. It contains the following columns:

| Column           | Description                                                      |
|------------------|------------------------------------------------------------------|
| w303_gene_id     | W303-specific gene identifier                                    |
| locus_tag        | Locus tag from annotation                                        |
| sc_gene_id       | SGD gene ID (if available)                                       |
| std_gene_name    | Standard S. cerevisiae gene name (e.g., YGL258W)                 |
| erg_name         | Ergosterol pathway gene name (if applicable)                     |
| w303_scaffold    | Friendly scaffold number (e.g., w303_scaffold_7)                 |
| chromosome_id    | GenBank accession (e.g., CM007970.1)                             |
| start            | Gene start position (1-based)                                    |
| end              | Gene end position (1-based)                                      |
| strand           | Strand (+ or -)                                                  |
| product          | Gene product description                                         |

This format enables flexible and robust mapping of variants to genes, and supports downstream analyses and reporting.

## Implementation Steps

### 1. Generate the Mapping File
- Run the script: `python scripts/general_gene_analysis/generate_gene_mapping_full.py`
- This will create or update `reference/gene_mapping_full.tsv` with all genes and coordinates from all scaffolds.

### 2. Update Analysis Scripts
- The scripts in `scripts/general_gene_analysis/` should be updated to:
  - Load the new mapping file (`reference/gene_mapping_full.tsv`)
  - Use the `w303_scaffold` and `chromosome_id` fields to map variants to genes on all chromosomes
  - Use `std_gene_name` and `erg_name` for gene set/group analyses
  - Add robust error handling and logging for chromosome mismatches or missing data

#### How to Update Scripts
1. **Change the mapping file path** in each script to point to `reference/gene_mapping_full.tsv`.
2. **Update the variant-to-gene mapping function** to:
   - Use both `w303_scaffold` and `chromosome_id` for matching
   - Handle all chromosomes present in the variant data
   - Log or report any chromosome mismatches
3. **Test the mapping** by running the script and checking that variants are mapped to genes across all chromosomes.

### 3. Re-run the Analysis
- Run the updated scripts on your variant data.
- You should now get variant mappings for many more genes, enabling genome-wide gene-level analyses.
- Analyze variant distribution, enrichment, and purifying selection for any gene or gene set of interest.

## Best Practices
- **Test incrementally:** After updating each script, test with a small dataset to ensure correct mapping and output.
- **Maintain consistency:** Use the same mapping file and data structures across all scripts.
- **Document changes:** Update docstrings and comments to reflect the new mapping and logic.
- **Log issues:** Add logging for any mapping or data issues to facilitate debugging.

## Summary

This project enables robust, genome-wide gene-level analysis of yeast mutation data by:
- Generating a comprehensive gene mapping file from GenBank annotations
- Updating analysis scripts to use this mapping for all chromosomes and genes
- Supporting advanced analyses of selection, enrichment, and gene-specific patterns

For further details, see `scripts/gene_analysis/context.md` and the code in `scripts/general_gene_analysis/`. 